<div class="conversation-container">

  <mat-progress-bar *ngIf="isLoading" mode="indeterminate" style="margin-top: 10px;"></mat-progress-bar>

  <div *ngIf="otherUser" class="conv-header">
    <h3>{{ otherUser.prenom }} {{ otherUser.nom }} {{ otherUser.role === RoleUtilisateur.MEDECIN ? ' — ' + otherUser.specialite : ''}}</h3>
    <p *ngIf="otherUser.role === RoleUtilisateur.PATIENT">NISS : {{ otherUser.niss }}</p>
    <p *ngIf="otherUser.role === RoleUtilisateur.MEDECIN">INAMI : {{ otherUser.numINAMI }}</p>
    <span class="role">{{ otherUser.role }}</span>
  </div>


  <div #scrollContainer class="messages">

    <div *ngFor="let m of messages"
         class="msg"
         [class.me]="m.emetteurId === currentUserId">

      <div class="bubble">

        <p>{{ m.contenu }}</p>

        <div *ngIf="m.document" class="attachment">
          <button mat-stroked-button (click)="viewDocument(m.document)">
            <mat-icon>attach_file</mat-icon> 
            {{ m.document.nom }}
          </button>
        </div>

        <span class="date">
          {{ m.dateEnvoi | date:'short':'':'fr-FR' }}
        </span>

      </div>
    </div>

  </div>

  <div class="input-bar">

    <input [(ngModel)]="newMessage"
           (keyup.enter)="send()"
           placeholder="Écrire un message…">

    <div *ngIf="selectedFile" class="file-preview">
      <mat-icon>attach_file</mat-icon>
      {{ selectedFile.name }}
      <button mat-icon-button color="warn" (click)="removeSelectedFile()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <input type="file" (change)="onFileSelected($event)" hidden #fileInput>

    <button mat-icon-button (click)="fileInput.click()">
      <mat-icon>attach_file</mat-icon>
    </button>

    <button mat-icon-button color="primary" (click)="send()">
      <mat-icon>send</mat-icon>
    </button>

  </div>
</div>
